{% extends "layout.html" %}
{% block title %}Dashboard Summary - DhanBot{% endblock %}

{% block content %}
<!-- Link to your new stylesheet -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">

<div class="background-shapes">
    <div class="shape shape1"></div>
    <div class="shape shape2"></div>
</div>

<div class="container">
    <!-- Header Module -->
    <header class="header-module glass-panel animated-reveal">
        <div class="header-top">
            <h1 class="header-title">Welcome, {{ display_name or 'User' }} ðŸ‘‹</h1>
            <div class="header-actions">
                <a class="btn btn-primary" href="/copy-trading">
                    <i class="bi bi-people-fill"></i> Copy Trading
                </a>
            </div>
        </div>
        <div class="stats-bar">
            <div class="stat-item">
                <p class="stat-label">Plan Name</p>
                <h2 class="stat-value">{{ plan_name or 'N/A' }}</h2>
            </div>
            <div class="stat-item">
                <p class="stat-label">Days Remaining</p>
                <h2 class="stat-value {% if days_remaining and days_remaining <= 7 %}danger{% endif %}">{{ days_remaining or '0' }} Days</h2>
                {% if days_remaining and days_remaining <= 7 %}
                <div class="stat-footer">
                    <a href="/subscriptions">Renew</a>
                </div>
                {% endif %}
            </div>
            <div class="stat-item">
                <p class="stat-label">Validity</p>
                <h2 class="stat-value">{{ expiry_date or 'N/A' }}</h2>
            </div>
        </div>
    </header>

    <div class="main-grid">
        <!-- Left Column: Status Modules -->
        <div class="left-column" style="display: flex; flex-direction: column; gap: var(--space-6);">
            {% if strategies %}
            <div class="glass-panel animated-reveal">
                <h3 class="section-title">Strategies</h3>
                {% for s in strategies %}
                <div class="list-item">
                    <div class="item-main-info">
                        <p class="title">{{ s.name }}</p>
                        <p class="subtitle pnl {% if s.pnl >= 0 %}positive{% else %}negative{% endif %}">7d P&L: {{ '%.2f'|format(s.pnl) }}</p>
                    </div>
                    <div class="item-meta-info">
                        <span class="badge {% if s.is_active %}badge-success{% else %}badge-default{% endif %}">{{ 'Active' if s.is_active else 'Inactive' }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            {% if accounts %}
            <div class="glass-panel animated-reveal">
                <h3 class="section-title">Accounts</h3>
                {% for acc in accounts %}
                <div class="list-item">
                    <div class="item-main-info">
                        <p class="title">{{ acc.client_id }}</p>
                        <p class="subtitle">{{ acc.broker }}</p>
                    </div>
                    <div class="item-meta-info">
                        <span class="badge {% if acc.status == 'Active' %}badge-success{% else %}badge-default{% endif %}">{{ acc.status }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <!-- Right Column: Activity Feed -->
        <div class="right-column">
            {% if recent_trades or notifications %}
            <div class="glass-panel animated-reveal">
                <h3 class="section-title">Activity Feed</h3>
                {% if recent_trades %}
                    {% for t in recent_trades %}
                    <div class="list-item feed-item">
                        <i class="bi {% if t.action == 'BUY' %}bi-graph-up-arrow{% else %}bi-graph-down-arrow{% endif %} feed-icon"></i>
                        <div class="feed-content">
                            <p class="message">Trade Executed</p>
                            <p class="details">{{ t.action }} {{ t.symbol }} ({{ t.qty }} @ {{ '%.2f'|format(t.price) }})</p>
                        </div>
                    </div>
                    {% endfor %}
                {% endif %}

                {% if notifications %}
                    {% for n in notifications %}
                    <div class="list-item feed-item">
                        <i class="bi bi-bell-fill feed-icon"></i>
                        <div class="feed-content">
                            <p class="message">{{ n.message }}</p>
                        </div>
                        <span class="feed-timestamp">{{ n.timestamp.strftime('%H:%M') }}</span>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
